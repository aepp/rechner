var initialized;
$(document).ready(function() {
	if (initialized) {
		return;
	}
	initialized = true;
	var pageInitialized = false;
	if(pageInitialized) return true;
    pageInitialized = true;
	var tableFields = getFields_produkt();
	var defaultSorting = 'produktName ASC';
	if($("#produktTable").find(".jtable-main-container").length > 0){
		$('#produktTable').jtable('destroy');
	} 
    $('#produktTable').jtable({
    	title: "Produktübersicht",
    	jqueryuiTheme: true,
        paging: true,
        pageSize: 10,
        sorting: true,
        defaultSorting: defaultSorting,
        selecting: true,
        multiselect: true,
        selectingCheckboxes: true,
        selectOnRowClick: true,
        loadingAnimationDelay: 20,
        ajaxSettings: {
            type: 'POST',
            dataType: 'json'
        },
        toolbar: {
            hoverAnimation: true, //Enable/disable small animation on mouse hover to a toolbar item.
            hoverAnimationDuration: 60, //Duration of the hover animation.
            hoverAnimationEasing: undefined, //Easing of the hover animation. Uses jQuery's default animation ('swing') if set to undefined.
            items: [{
                text: 'Aktualisieren',
                icon: '../img/refresh-icon.png',
                cssClass: 'refreshButton',
                click: function () {
                	$('#produktTable').jtable('reload');
                }
            }]
        },
        actions: {
    		listAction:   'produkt/list',
            createAction: 'produkt/create',
            updateAction: 'produkt/edit',
            deleteAction: 'produkt/delete'
        },
        fields: tableFields,
        selectionChanged: function () {
        	$('#produktTable').append('<a class="btn btn-alert" id="deleteSelectedButton" href="#">Ausgewählte Einträge löschen</button>');
        	$('#produktTable').jtable('selectedRows');
        },
    });
    
    $('#produktTable').jtable('load');

    $('#deleteSelectedButton').click(function () {
        var $selectedRows = $('#produktTable').jtable('selectedRows');
        $('#produktTable').jtable('deleteRows', $selectedRows);
    });
});  	
function getFields_produkt(){
	fields = {
        produktId: {
            key: true,
            list: false
        },
        produktName: {
            title: 'Produktname'
        },	
        bankLogo: {
            title: 'Bank',
            width: '45%',
            display: function (data) {
                return '<img src="uploads/bank-logo/'+data.record.bankLogo+'" class="bank-logo-preview"/>';
            },
        },	
	};
	return fields;
}
